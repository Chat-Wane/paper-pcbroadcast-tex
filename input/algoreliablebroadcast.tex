\SetKwProg{Function}{function}{}{}
\SetKwProg{Upon}{upon}{}{}
\SetKwProg{Initially}{INITIALLY:}{}{}
\SetKwProg{Dissemination}{DISSEMINATION:}{}{}

\small

\DontPrintSemicolon
\LinesNumbered

\Initially {} {
  $Q$ \tcp*{$p$'s neighborhood}
  $received \leftarrow \varnothing$ \tcp*{To detect double receipts}
}

\BlankLine

\Dissemination{}{
  
  \Function{\textsc{R-broadcast}($m$) \tcp*[f]{$b_p(m)$}} { 
    $received \leftarrow received \cup m$ \;
    \lForEach {$q \in Q$} {\textsc{sendTo}($q,\, m$)}
    \textsc{R-deliver}($m$) \tcp*{$d_p(m)$}
  }

  \BlankLine
  
  \Upon{\textsc{receive}($m$)}{
    \If {$m \not \in received$} {
      $received \leftarrow received \cup m$ \;
      \lForEach {$q \in Q$} {\textsc{sendTo}($q,\, m$) \tcp*[f]{forward}}
      \textsc{R-deliver}($m$) \tcp*{$d_p(m)$}
    }
  }
  
}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End:
